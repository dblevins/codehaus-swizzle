{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13036192","self":"https://issues.apache.org/jira/rest/api/2/issue/13036192","key":"TOMEE-2000","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12312320","id":"12312320","key":"TOMEE","name":"TomEE","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12312320&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12312320&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12312320&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12312320&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10251","id":"10251","description":"","name":"OpenEJB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12338670","id":"12338670","description":"Maintenance release EE7","name":"7.0.3","archived":false,"released":true,"releaseDate":"2017-03-13"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2017-01-19T13:03:39.890+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Aug 01 11:52:10 UTC 2017","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_16760505043_*|*_5_*:*_1_*:*_0","customfield_12310420":"9223372036854775807","customfield_12312321":null,"resolutiondate":"2017-08-01T11:52:10.504+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/TOMEE-2000/watchers","watchCount":3,"isWatching":false},"created":"2017-01-19T12:10:25.637+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12336943","id":"12336943","description":"Maintenance release EE7","name":"7.0.2","archived":false,"released":true,"releaseDate":"2016-11-11"}],"customfield_12312339":null,"issuelinks":[],"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-08-01T11:54:00.995+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12327328","id":"12327328","name":"TomEE Core Server","description":"Server elements"}],"timeoriginalestimate":null,"description":"There seems to be a bug on HTTPS feature. We've setup SSL on two different machine (Redhat and CentOS) using two different SSL certificates, and the exact same problem happen. \n\nAt first, TomEE runs normally, but after a few days (we are not exactly sure how long), TomEE starts to have stability problem. In our case, TomEE starts to have abnormal CPU consumption (~20% on all CPU cores) even when there is no connection. Furthermore, when the server start to have HTTPS workloads, TomEE did crash. So, we decided to disable SSL from our TomEE server, and everything come back to normal.\n\nSorry that we did not record all the problems appropriately (the time we test SSL on the 1st and 2nd server is about 2 months), but now that we found the same problem happen on the 2nd server. We are quite sure that TomEE has stability problem with SSL.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12848839","id":"12848839","filename":"%CPU usage (java) with zero request.png","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkeerati","name":"jkeerati","key":"jkeerati","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Keerati","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-23T06:44:23.837+0000","size":124584,"mimeType":"image/png","content":"https://issues.apache.org/jira/secure/attachment/12848839/%25CPU+usage+%28java%29+with+zero+request.png"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12850614","id":"12850614","filename":"CPU usage 20170202.png","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkeerati","name":"jkeerati","key":"jkeerati","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Keerati","active":true,"timeZone":"Etc/UTC"},"created":"2017-02-02T09:44:16.102+0000","size":197538,"mimeType":"image/png","content":"https://issues.apache.org/jira/secure/attachment/12850614/CPU+usage+20170202.png"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12848840","id":"12848840","filename":"jstack.out","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkeerati","name":"jkeerati","key":"jkeerati","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Keerati","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-23T06:45:47.220+0000","size":42682,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12848840/jstack.out"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12850615","id":"12850615","filename":"jstack-20170202.out","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkeerati","name":"jkeerati","key":"jkeerati","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Keerati","active":true,"timeZone":"Etc/UTC"},"created":"2017-02-02T09:44:46.791+0000","size":39361,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12850615/jstack-20170202.out"}],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"TomEE PLUME 7.0.2 stability problem when using HTTPS on both Redhat and CentOS","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkeerati","name":"jkeerati","key":"jkeerati","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Keerati","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkeerati","name":"jkeerati","key":"jkeerati","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Keerati","active":true,"timeZone":"Etc/UTC"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"Red Hat Enterprise Linux Server release 7.2 (Maipo)\nCentOS Linux release 7.2.1511 (Core) \nJava(TM) SE Runtime Environment (build 1.8.0_101-b13) (64-bit server)","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13036192/comment/15829880","id":"15829880","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgallimore","name":"jgallimore","key":"jgallimore","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jonathan Gallimore","active":true,"timeZone":"Etc/UTC"},"body":"Hi\n\nThanks for logging this ticket. In order to help solve the issue, we'll need a bit more information:\n\n* What sort of workloads is your server handling? Specifically, I'm curious about requests per second, and the types of request.\n* How do you have SSL configured - have you just imported your private key / certificate to a java keystore, or do you use the native connector?\n* Are you using BIO or NIO on your HTTPS connector (you could provide server.xml with any sensitive data removed)\n* Probably the most helpful thing would be to get a thread dump when your server is in this state. To do that, you can run jstack passing the PID of TomEE in as a parameter.  If you're able to get that and send it to the mailing list or attach it to this ticket, that would be really helpful.\n\nRegards\n\nJon","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgallimore","name":"jgallimore","key":"jgallimore","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jonathan Gallimore","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-19T13:03:39.890+0000","updated":"2017-01-19T13:03:39.890+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13036192/comment/15831182","id":"15831182","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkeerati","name":"jkeerati","key":"jkeerati","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Keerati","active":true,"timeZone":"Etc/UTC"},"body":"1. What sort of workloads is your server handling? Specifically, I'm curious about requests per second, and the types of request.\njust a simple https GET/POST requests (user session is handling by TomEE). For the first case, requests per second is less than 50 . For the 2nd case, requests per second is less than 1. I think the problem comes from time than requests per second. It takes a few days for the problem to develop.\n\n2. How do you have SSL configured - have you just imported your private key / certificate to a java keystore, or do you use the native connector?\nI import my private key / certificate to a java keystore.\n\n3. Are you using BIO or NIO on your HTTPS connector (you could provide server.xml with any sensitive data removed)\nWe uses HTTP/1.1 auto-switching mechanism. Below is a sample of our server.xml.\n\n    <Connector port=\"443\" protocol=\"HTTP/1.1\"\n               maxThreads=\"500\" SSLEnabled=\"true\" scheme=\"https\" secure=\"true\"\n               clientAuth=\"false\" sslProtocol=\"TLS\"\n               keystoreFile=\"xxx\"\n               keystorePass=\"xxx\" keyAlias=\"xxx\"\n        ciphers=\"TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256,TLS_ECDHE_RSA_WITH_AES_1$\n   TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA,TLS$\n   TLS_RSA_WITH_AES_128_CBC_SHA256,TLS_RSA_WITH_AES_128_CBC_SHA,TLS_RSA_WITH_AE$\n   TLS_RSA_WITH_AES_256_CBC_SHA,SSL_RSA_WITH_RC4_128_SHA\"/>\n\n4. Probably the most helpful thing would be to get a thread dump when your server is in this state. To do that, you can run jstack passing the PID of TomEE in as a parameter. If you're able to get that and send it to the mailing list or attach it to this ticket, that would be really helpful.\nIf we success in reproducing the problem, we will send you the thread dump.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkeerati","name":"jkeerati","key":"jkeerati","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Keerati","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-20T04:41:47.188+0000","updated":"2017-01-20T04:41:47.188+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13036192/comment/15833971","id":"15833971","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkeerati","name":"jkeerati","key":"jkeerati","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Keerati","active":true,"timeZone":"Etc/UTC"},"body":"Thread dump when the problem occur.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkeerati","name":"jkeerati","key":"jkeerati","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Keerati","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-23T06:45:47.227+0000","updated":"2017-01-23T06:45:47.227+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13036192/comment/15833975","id":"15833975","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkeerati","name":"jkeerati","key":"jkeerati","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Keerati","active":true,"timeZone":"Etc/UTC"},"body":"This time we setup HTTPS, with very little server load (just a few page refresh I do manually). The first day, everything is working normally. Then, I come to check the server again today (today is the 4th day that the server is running), and the problem already occurred. So, I capture the cpu usage, and make the thread dump.\n\nIf there are other things we can help please let us know :)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkeerati","name":"jkeerati","key":"jkeerati","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Keerati","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-23T06:50:07.271+0000","updated":"2017-01-23T06:51:01.838+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13036192/comment/15834027","id":"15834027","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=romain.manni-bucau","name":"romain.manni-bucau","key":"romain.manni-bucau","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=romain.manni-bucau&avatarId=18453","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=romain.manni-bucau&avatarId=18453","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=romain.manni-bucau&avatarId=18453","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=romain.manni-bucau&avatarId=18453"},"displayName":"Romain Manni-Bucau","active":true,"timeZone":"Europe/Berlin"},"body":"Hi Keerati, here a few things to check:\n\n- does it occur with oracle JVM instead of OpenJDK\n- do you have the ability to switch off AJP (relying on HTTPS connector)? (- do you have the ability to switch off HTTPS relying on AJP connector?)\n- what's your mod_jk/mod_proxy versions? are they consistent with tomcat ones?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=romain.manni-bucau","name":"romain.manni-bucau","key":"romain.manni-bucau","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=romain.manni-bucau&avatarId=18453","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=romain.manni-bucau&avatarId=18453","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=romain.manni-bucau&avatarId=18453","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=romain.manni-bucau&avatarId=18453"},"displayName":"Romain Manni-Bucau","active":true,"timeZone":"Europe/Berlin"},"created":"2017-01-23T07:59:56.273+0000","updated":"2017-01-23T07:59:56.273+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13036192/comment/15834043","id":"15834043","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkeerati","name":"jkeerati","key":"jkeerati","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Keerati","active":true,"timeZone":"Etc/UTC"},"body":"Hi Romain,\nWe use Oracle JVM (java 1.8). \nWe also use TomEE to serve static web content. So, we use standalone TomEE (we didn't use \"httpd\" Apache HTTP Server).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkeerati","name":"jkeerati","key":"jkeerati","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Keerati","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-23T08:16:28.077+0000","updated":"2017-01-23T08:20:01.520+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13036192/comment/15834050","id":"15834050","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=romain.manni-bucau","name":"romain.manni-bucau","key":"romain.manni-bucau","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=romain.manni-bucau&avatarId=18453","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=romain.manni-bucau&avatarId=18453","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=romain.manni-bucau&avatarId=18453","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=romain.manni-bucau&avatarId=18453"},"displayName":"Romain Manni-Bucau","active":true,"timeZone":"Europe/Berlin"},"body":"Hmm, jstack was the OpenJDK one, can you log maybe the JAVA_HOME from setenv.sh to validate it doesnt inherit from another one?\nIf tomee is used directly drop the AJP connector, will not change anything for you and will allow to eliminate this \"?\" for this issue.\n\nOne \"?\" I have with the thread dump is if it is linked to nio connector or if it misses some threads cause of permissions cause server doesn't do much there.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=romain.manni-bucau","name":"romain.manni-bucau","key":"romain.manni-bucau","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=romain.manni-bucau&avatarId=18453","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=romain.manni-bucau&avatarId=18453","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=romain.manni-bucau&avatarId=18453","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=romain.manni-bucau&avatarId=18453"},"displayName":"Romain Manni-Bucau","active":true,"timeZone":"Europe/Berlin"},"created":"2017-01-23T08:20:09.295+0000","updated":"2017-01-23T08:20:09.295+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13036192/comment/15834061","id":"15834061","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkeerati","name":"jkeerati","key":"jkeerati","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Keerati","active":true,"timeZone":"Etc/UTC"},"body":"We just install OpenJDK to use jstack, we will recheck which jvm TomEE is running.\n\nDo you mean that we should drop the AJP connector, restart the server, and let's see whether the problem still persist? It will require a few more days to validate the result.\n\n<Connector port=\"8009\" protocol=\"AJP/1.3\" redirectPort=\"8443\" />\n\nWe should comment out the above line, is that correct?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkeerati","name":"jkeerati","key":"jkeerati","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Keerati","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-23T08:30:00.058+0000","updated":"2017-01-23T08:35:43.701+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13036192/comment/15834062","id":"15834062","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=romain.manni-bucau","name":"romain.manni-bucau","key":"romain.manni-bucau","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=romain.manni-bucau&avatarId=18453","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=romain.manni-bucau&avatarId=18453","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=romain.manni-bucau&avatarId=18453","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=romain.manni-bucau&avatarId=18453"},"displayName":"Romain Manni-Bucau","active":true,"timeZone":"Europe/Berlin"},"body":"Yes, I'd start by that. If still an issue maybe try to use jstack -F <pid> when it happens and kill -3 if it doesn't give more data. Also try to take multiple jstack to ensure you don't miss the cpu consuming method. Previous one has no real blocking calls - hope i didnt miss it - except on IO so related to the JVM mainly.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=romain.manni-bucau","name":"romain.manni-bucau","key":"romain.manni-bucau","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=romain.manni-bucau&avatarId=18453","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=romain.manni-bucau&avatarId=18453","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=romain.manni-bucau&avatarId=18453","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=romain.manni-bucau&avatarId=18453"},"displayName":"Romain Manni-Bucau","active":true,"timeZone":"Europe/Berlin"},"created":"2017-01-23T08:33:09.467+0000","updated":"2017-01-23T08:33:09.467+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13036192/comment/15834066","id":"15834066","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkeerati","name":"jkeerati","key":"jkeerati","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Keerati","active":true,"timeZone":"Etc/UTC"},"body":"You mean that from my thread dump there is a blocking call on IO, and it seems to cause from JVM?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkeerati","name":"jkeerati","key":"jkeerati","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Keerati","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-23T08:36:41.275+0000","updated":"2017-01-23T08:36:41.275+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13036192/comment/15834068","id":"15834068","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=romain.manni-bucau","name":"romain.manni-bucau","key":"romain.manni-bucau","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=romain.manni-bucau&avatarId=18453","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=romain.manni-bucau&avatarId=18453","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=romain.manni-bucau&avatarId=18453","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=romain.manni-bucau&avatarId=18453"},"displayName":"Romain Manni-Bucau","active":true,"timeZone":"Europe/Berlin"},"body":"I meant there is nothing that suspicious in the dump, all running threads are blocked on a lock or io (blocking read) so cpu shouldn't be that high except if one of these is CPU consuming and the only one I can see as such is the https-nio one but it shouldnt.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=romain.manni-bucau","name":"romain.manni-bucau","key":"romain.manni-bucau","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=romain.manni-bucau&avatarId=18453","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=romain.manni-bucau&avatarId=18453","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=romain.manni-bucau&avatarId=18453","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=romain.manni-bucau&avatarId=18453"},"displayName":"Romain Manni-Bucau","active":true,"timeZone":"Europe/Berlin"},"created":"2017-01-23T08:38:59.578+0000","updated":"2017-01-23T08:38:59.578+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13036192/comment/15845348","id":"15845348","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkeerati","name":"jkeerati","key":"jkeerati","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Keerati","active":true,"timeZone":"Etc/UTC"},"body":"We dropped AJP connector wait for 3-4 days, and the problem did not occur again. But during that time, our web app have problem connecting with database. So, we are not sure the problem is solved from dropping AJP or from not connecting database. Now, we are testing again with database connection and without AJP. We will inform you again for the result.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkeerati","name":"jkeerati","key":"jkeerati","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Keerati","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-30T15:51:39.532+0000","updated":"2017-01-30T15:51:39.532+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13036192/comment/15849724","id":"15849724","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkeerati","name":"jkeerati","key":"jkeerati","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Keerati","active":true,"timeZone":"Etc/UTC"},"body":"After connecting web app to database and wait a few days, the problem reoccurred. So, it seems that the problem is related to database (we're using postgres 9.4), but it is strange that the problem occurs only when we use HTTPS (plain HTTP with db connection does not cause the problem).\n\nWe already make the thread dump and a screenshot. Please let us know, if you want more information.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkeerati","name":"jkeerati","key":"jkeerati","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Keerati","active":true,"timeZone":"Etc/UTC"},"created":"2017-02-02T09:42:14.130+0000","updated":"2017-02-02T09:42:14.130+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13036192/comment/15849735","id":"15849735","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=romain.manni-bucau","name":"romain.manni-bucau","key":"romain.manni-bucau","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=romain.manni-bucau&avatarId=18453","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=romain.manni-bucau&avatarId=18453","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=romain.manni-bucau&avatarId=18453","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=romain.manni-bucau&avatarId=18453"},"displayName":"Romain Manni-Bucau","active":true,"timeZone":"Europe/Berlin"},"body":"wonder if linked to https://bz.apache.org/bugzilla/show_bug.cgi?id=60030. In any case tomee doesn't contral that part so surely more relevant to open a ticket on tomcat bugtracker specifying it happens with tomcat 8.5.6 - or test with tomee snapshot if you can which is way ahead in term of tomcat upgrade","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=romain.manni-bucau","name":"romain.manni-bucau","key":"romain.manni-bucau","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=romain.manni-bucau&avatarId=18453","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=romain.manni-bucau&avatarId=18453","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=romain.manni-bucau&avatarId=18453","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=romain.manni-bucau&avatarId=18453"},"displayName":"Romain Manni-Bucau","active":true,"timeZone":"Europe/Berlin"},"created":"2017-02-02T09:51:09.188+0000","updated":"2017-02-02T09:51:09.188+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13036192/comment/15855522","id":"15855522","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkeerati","name":"jkeerati","key":"jkeerati","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Keerati","active":true,"timeZone":"Etc/UTC"},"body":"sorry for late reply. I guess your suggestion is correct. If we have time, we will test this issue on tomcat 8.5.6. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkeerati","name":"jkeerati","key":"jkeerati","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Keerati","active":true,"timeZone":"Etc/UTC"},"created":"2017-02-07T07:53:30.617+0000","updated":"2017-02-07T07:53:30.617+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13036192/comment/16108763","id":"16108763","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkeerati","name":"jkeerati","key":"jkeerati","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Keerati","active":true,"timeZone":"Etc/UTC"},"body":"-","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkeerati","name":"jkeerati","key":"jkeerati","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Keerati","active":true,"timeZone":"Etc/UTC"},"created":"2017-08-01T11:49:11.345+0000","updated":"2017-08-01T11:54:00.986+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13036192/comment/16108766","id":"16108766","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkeerati","name":"jkeerati","key":"jkeerati","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Keerati","active":true,"timeZone":"Etc/UTC"},"body":"We already found out that some tomee libraries (jar) are in beta version. Those beta jar cause instability. I'm not sure why our server has those beta libraries, it probably came from TomEE PLUME M3 or some early version of TomEE PLUME 7.0.2. Anyway, the latest version of TomEE PLUME don't have those beta libraries. So, the problem is resolved.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkeerati","name":"jkeerati","key":"jkeerati","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Keerati","active":true,"timeZone":"Etc/UTC"},"created":"2017-08-01T11:52:10.660+0000","updated":"2017-08-01T11:52:10.660+0000"}],"maxResults":17,"total":17,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/TOMEE-2000/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i38xgf:"}}